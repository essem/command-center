<!DOCTYPE html>
<html>

<head>
<title>Command Center</title>
<script src="/javascripts/jquery-2.1.3.min.js"></script>
<style>
body {
  background-color: #272822;
  color: white;
}
#command_text {
  width: 100%;
  box-sizing: border-box;
  margin-bottom: 10px;
  padding: 5px 10px;
  border: 1px solid #AFAFAE;
  background-color: #272822;
  color: white;
}
#result {
  width: 100%;
  display: block;
  unicode-bidi: embed;
  font-family: monospace;
  white-space: pre;
  margin-top: 10px;
}
input[type=button] {
  background-color: #3E3E3C;
  padding: 3px 10px;
  border: 1px solid #AFAFAE;
  color: #AFAFAE;
}
</style>
</head>

<body>

<form id="command_form" action="/execute">
<input type="text" id="command_text" name="command" placeholder="Enter command here..." autofocus>
</form>

<input type="button" value="top" data-command="top -bn1"/>
<input type="button" value="ps" data-command="ps -ef"/>
<input type="button" value="df" data-command="df -h"/>
<input type="button" value="du" data-command="sudo du --max-depth=1 --exclude=/proc / | sort -n"/>
<input type="button" value="port" data-command="lsof -i | grep LISTEN"/>
<input type="button" value="dmesg" data-command="dmesg"/>
<input type="button" value="uptime" data-command="uptime"/>
<input type="button" value="syslog" data-command="sudo tail -50 /var/log/syslog"/>
<input type="button" value="hi" data-command="<%=h "echo \"hello world\"" %>"/>

<div id="result"></div>

<script>
function request_execution(command)
{
  var body = $("body")[0]
  $("#result").empty()

  // it's not easy to get jqXHR's onreadystatechange event
  // just use default XMLHttpRequest

  var xhr = new XMLHttpRequest()
  xhr.last_length = 0

  xhr.onreadystatechange = function() {
    if (xhr.readyState > 2) {
      var new_response = xhr.responseText.substring(xhr.last_length)
      $("#result").append(new_response)
      xhr.last_length = xhr.responseText.length
      body.scrollTop = body.scrollHeight
    }
  }

  xhr.open("POST", $("#command_form").attr("action"), true)
  xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
  xhr.send($("#command_form").serialize())
}

$(function () {
  $("#command_form").on("submit", function() {
    var command_text = $("#command_text")
    command_text.select()
    request_execution(command_text.val())
    return false
  })

  $("input[type=button]").on("click", function() {
    var command = $(this).attr("data-command")
    $("#command_text").val(command).select()
    request_execution(command)
  })
})
</script>

</body>
</html>
